# История изменений (Changelog)

Все значимые изменения проекта будут задокументированы в этом файле.

## [Unreleased]

## [0.0.1] - 2025-12-05
### Добавлено
- Начальная структура проекта.
- Файлы документации: README, ROADMAP, AI_RULES (переведены на русский).
- Базовое отслеживание задач.
- **Инфраструктура**: Docker Compose конфигурация (Bot, WebApp, Postgres).
- **Бот**: Базовая структура на Python (aiogram 3.x).
- **Интеграция**: Реализован сервис `NanoBananaService` на базе `google-genai`.
- **Функционал**: Поддержка 3-х моделей генерации (Nano Banana, Pro, Imagen) и команда `/generate`.
- **Web App**: Реализован React-интерфейс (выбор модели, настройки, ввод промпта) и стилизация "Nano Banana".
- **Бот**: Добавлена обработка данных (`web_app_data`) от Telegram Mini App.
- **Деплой**: Настроена конфигурация для публикации Web App на GitHub Pages.

## [0.0.2] - 2025-12-06
### Добавлено
- **UX**: В интерфейс бота добавлены кнопки для быстрого переключения режимов (Flash, Pro, Imagen) вместо dropdown-меню.
- **Диалоги**: Реализован режим полноценного диалога с моделью Nano Banana Pro (Gemini 3.0 Pro) для уточнения генераций.
- **Кнопка "Завершить"**: Добавлена специальная кнопка для явного выхода из режима диалога.
- **Аргументы**: Поддержка ключей `--2k` и `--4k` в тексте промпта для управления разрешением (при наличии доступа).
- **Аргументы**: Поддержка ключа `--ar X:Y` в тексте промпта для установки соотношения сторон.

### Изменено
- **Модели**: Обновлены системные промпты и конфигурации для использования новых моделей Gemini 2.5 Flash и Gemini 3.0 Pro.
- **Web App**: Полный редизайн выпадающего списка (Dropdown) для выбора соотношения сторон — теперь стильно и без багов (двойных стрелок).
- **Web App**: Улучшены отступы и визуальное разделение блоков в интерфейсе.
- **Web App**: Исправлены скроллбары.

### Исправлено
- Починена ошибка `NameError`, возникавшая при отправке фото-референса в чат.
- Исправлен баг с "двойным нажатием" на кнопку завершения или отмены, приводивший к ошибкам в логах.
- Исправлена работа команды `/pro` (восстановлено потерянное меню отмены).

## [0.0.3] - 2025-12-06
### Добавлено
- **Экономика**: Внедрена внутренняя валюта **NeuroCoin (NC)**.
- **Тарифы**: Реализована система тарифов: **Demo**, **Basic**, **Full**.
  - Demo: Бесплатно, 500 NC старт, только квадратные форматы, без 4K.
  - Basic: 390₽, +3000 NC/мес, любые форматы.
  - Full: 990₽, +8000 NC/мес, поддержка 4K, 5 референсов.
- **Профиль**: Команда `/profile` (Мой кабинет) с балансом, тарифом и сроком действия.
- **Покупка**: Меню `/buy` (пополнение NC) и `/upgrade` (смена тарифа).
- **Админ-панель**: 
  - Управление пользователями (Поиск по ID).
  - Смена тарифа, баланса и срока действия (включая "Бессрочно").

## [0.1.0] - 2025-12-06
### Major UX/UI Update & Navigation Fixes
### Добавлено
- **UX**: Полностью переработан флоу создания изображения (объединение этапов выбора и ввода промпта).
- **Навигация**: Реализованы глобальные обработчики кнопок меню ("Главное меню", "Мой кабинет", "Тарифы"), работающие из любого состояния.
- **Интерфейс**: Кнопка "Создать ещё" теперь запоминает и восстанавливает параметры предыдущей генерации (Модель, AR, Качество).
- **Сообщения**: Обновлены статусы генерации ("Будет списано", "Останется") для большей прозрачности до списания.
- **Результат**: Добавлено отображение использованного промпта (кодом) в финальном сообщении для удобного копирования.

### Изменено
- Убран технический вывод количества токенов из финального сообщения об успехе.
- Оптимизирована клавиатура в режиме создания (только "Главное меню" для минимализма).
- Автоматическое удаление меню настроек после успешного запуска генерации.

### Исправлено
- Исправлена критическая ошибка навигации, когда кнопка "Главное меню" воспринималась как промпт.
- Исправлена ошибка `NameError` при восстановлении меню (функция `show_config_menu`).
- Исправлен баг "тупика" в Inline-меню при нажатии кнопок Reply-клавиатуры.
  - Временные уведомления об успешных действиях (исчезают через 3 сек).
  - Удаление старой системы подтверждения регистрации (теперь авто-регистрация с уведомлением).

### Изменено
- **Рефакторинг**: Полный переход от устаревшего поля `access_level` к новой системе на базе `tariff`.
- **UX**: Улучшена навигация в админ-меню (кнопки "Назад", "Отмена", редактирование сообщений вместо спама).
- **База Данных**: Добавлены поля `balance`, `tariff`, `tariff_expires_at`.

### Исправлено
- Исправлено отображение "Бессрочно" для пользователей с неограниченным сроком тарифа.
- Исправлена работа кнопки "Изменить баланс" (баг с переменной).
